<!DOCTYPE html>
<html>
<head>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
</head>
<body>

<h2>Conix Demo: Edge Resource Manager</h2>

<h3 id='framework'></h3>

<form action="/start">
    <input type="submit" value="Start Tasks"/>
</form>
<br/>
<form action="/stop">
    <input type="submit" value="Stop Tasks"/>
</form>

<h3 id='numtasks'></h3>

<p id='tasks'></p>

<h3 id='numagents'></h3>

<p id='agents'></p>

<script>
function loadTasks(){
  var xmlHttp = new XMLHttpRequest();
  xmlHttp.onreadystatechange = function () {
    if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
      var resp = JSON.parse(xmlHttp.responseText);
      if(resp.error) {
        document.getElementById('tasks').innerHTML = resp.error.toString();
      } else {
        var tableHTML = "<table><tr><th>ID</th><th>Name</th><th>Agent Assigned</th><th>Framework</th><th>State</th></tr>"
        for(var i =0; i<resp.length;i++) {
          var task = resp[i];
          tableHTML += `<tr><td>${task.taskId}</td><td>${task.name}</td><td>${task.agentId}</td><td>${task.framework.name}</td><td>${task.state}</td></tr>`
        }
        tableHTML += "</table>"
        document.getElementById('tasks').innerHTML = tableHTML
        document.getElementById('numtasks').innerHTML = `${resp.length} Tasks`
      }
    } 
  }
  xmlHttp.open("GET", '/tasks', true);
  xmlHttp.send(null);
}
loadTasks();

function loadFramework(){
  var xmlHttp = new XMLHttpRequest();
  xmlHttp.onreadystatechange = function () {
    if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
      var resp = JSON.parse(xmlHttp.responseText);
      if(resp.error) {
        document.getElementById('framework').innerHTML = resp.error.toString();
      } else {
        document.getElementById('framework').innerHTML = `Framework: ${resp.framework.name}`
      }
    } 
  }
  xmlHttp.open("GET", '/framework', true);
  xmlHttp.send(null);
}
loadFramework();

function loadAgents() {
  var xmlHttp = new XMLHttpRequest();
  xmlHttp.onreadystatechange = function () {
    if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
      var resp = JSON.parse(xmlHttp.responseText);
      if(resp.error) {
        document.getElementById('agents').innerHTML = resp.error.toString();
      } else {
        var tableHTML = "<table><tr><th>ID</th><th>Name</th><th>Last Ping</th></tr>"
        for(var i =0; i<resp.length;i++) {
          var agent = resp[i];
          tableHTML += `<tr><td>${agent.id}</td><td>${agent.name}</td><td>${agent.lastPing}</td></tr>`
        }
        tableHTML += "</table>"
        document.getElementById('agents').innerHTML = tableHTML
        document.getElementById('numagents').innerHTML = `${resp.length} Agents`
      }
    } 
  }
  xmlHttp.open("GET", '/agents', true);
  xmlHttp.send(null);
}
loadAgents();
</script>

</body>
</html>

